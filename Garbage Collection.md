## 1. 가비지 컬렉션

> 가비지 컬렉션 (Garbage Collection)
>> 필요성, 메커니즘, 코드
>>> 어떻게 하면 GC로도 메모리 leak이 발생될까?    
---    
## 2. 가비지 컬렉션이란?
가비지 컬렉션은 자바의 메모리 관리 방법 중의 하나로 JVM의 Heap 영역에서 **동적으로 할당했던 메모리 영역 중 필요 없게 된 메모리 영역을 주기적으로 삭제하는 프로세스**를 말한다. C나 C++에서는 이러한 가비지 컬렉션이 없어 프로그래머가 수동으로 메모리 할당과 해제를 일일이 해줘야 하는 반면, Java는 JVM에 탑재되어 있는 가비지 컬렉터가 메모리 관리를 대행해주기 때문에 개발자 입장에서 메모리 관리, 메모리 누수(Memory Leak) 문제에서 대해 완벽하게 관리하지 않아도 되어 오롯이 개발에만 집중할 수 있다는 장점이 있다.    

 ##### 가비지 컬렉션의 단점
1. 개발자가 메모리가 언제 해제되는지 정확하게 알 수 없다.
2. 가비지 컬렉션(GC)이 동작하는 동안에는 다른 동작을 멈추기 때문에 오버헤드가 발생한다.

---
## 3. 가비지 컬렉션의 자세한 개념 (C#)

C/C++은 프로그래머가 힙에 객체를 할당하고 나서,이에 대한 해제를 해주는 코드가 필수적이다. 만약 해제 코드를 누락할 시 메모리 누수, 프로그램 오류 등의 문제가 발생하게 된다.
C#에서는 힙에 할당한 객체는 CLR이 자동으로 수거해준다.
CLR은 더 이상 사용하지 않는 객체는 쓰레기(Garbage)로 판단하는데 **이 메모리 쓰레기를 수거(Collection)하는 것이 가비지 컬렉션(Garbage Collection)** 이다.

---

## 4. CLR이 객체를 할당하는 과정
CLR은 어플리케이션을 수행하면, 해당 어플리케이션을 위한 메모리 공간을 통째로 확보한다. 즉, **하나의 관리되는 힙(Managed Heap)** 을 마련한다. 객체가 할당될 때마다 관리되는 힙에 순차적으로 적재된다.  
![image](https://github.com/Oeuni/BigData/assets/100830777/81ad4adb-3419-4c00-bfa3-7d253681dc79)  
그림을 보면 CLR이 힙을 생성하고 나면 다음 노드를 할당할 메모리의 포인터가 지정되고, 그 위치에 A라는 객체를 할당했을 때 차지된 메모리의 바로 다음에 미리 다음 노드를 할당할 메모리 포인터를 지정해놓는다.

---

## 5. 쓰레기가 생길 때
```C#
if(true)
{
   object a = new object();
}
```

![image](https://github.com/Oeuni/BigData/assets/100830777/fe292b53-bc22-46db-9619-d2908f46d74a)

a는 참조이고, new object() 부분에서 힙에 할당되는 객체가 생성된다. 즉, a라는 변수를 통해 메모리 A를 가리키게 되는 것이다. 이 코드가 실행되고 나면 참조변수 a는 자동으로 소멸되어 스택에서 사라진다. 그러나 힙에는 A 객체가 그대로 남아있다.

---

## 6. 가비지 컬렉션 과정

![image](https://github.com/Oeuni/BigData/assets/100830777/b7dd87e3-8b0e-48e9-bcbb-83a19c50713b)  

● GC 루트(Root) - 루트는 힙에 있는 객체를 붙드는 참조로, 이전 코드의 a를 의미한다.
● a처럼 스택에 생성될 수도 있지만, 정적 필드인 경우엔 힙에 생성될 수도 있다.
● .NET 어플리케이션 실행시, JIT 컴파일러는 루트 목록이 생성되고CLR은 이 루트 목록을 관리하며 상태 갱신한다.
● 루트 목록은 가비지 컬렉터가 참조하는 중요 자료이다.  

---

![image](https://github.com/Oeuni/BigData/assets/100830777/285af0b3-02cb-4d36-aabd-a4a25da483b5)  

● 가비지 컬렉터는 초기에 모든 객체가 쓰레기라고 가정한다. (즉, 루트 목록 내의 어떤 루트도 메모리를 가리키지 않는다고 가정)
● 루트 목록을 순회하면서 각 루트가 참조하는 힙 객체와의 관계를 조사한다.
   ● 어떤 힙과도 관계가 없는 루트가 있다면, 이 루트는 쓰레기로 간주한다.
   ● 다른 힙 객체를 참조하는 힙 객체는 쓰레기가 아니다.
● 쓰레기 객체가 차지하고 있던 메모리는 이제 '비어있는 공간'이 된다.

---

![image](https://github.com/Oeuni/BigData/assets/100830777/ab50fddc-f986-4561-808d-cff02df9c489)  
루트 목록에 대한 조사 후, 가비지 컬렉터는 힙을 순회하며 쓰레기가 차지하고 있던 '비어있는 공간'으로 쓰레기의 인접한 객체들을 이동하여 정리한다.
